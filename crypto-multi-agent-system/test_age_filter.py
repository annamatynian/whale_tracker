#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: —Ñ–∏–ª—å—Ç—Ä –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤
"""

import sys
from pathlib import Path
from datetime import datetime

PROJECT_ROOT = Path(__file__).parent
sys.path.insert(0, str(PROJECT_ROOT))

from agents.pump_analysis.pump_discovery_agent import PumpDiscoveryAgent, PUMP_FILTERS

def test_age_filter():
    """–¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ - –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï"""
    print("üß™ –¢–ï–°–¢ –§–ò–õ–¨–¢–†–ê –í–û–ó–†–ê–°–¢–ê –¢–û–ö–ï–ù–û–í")
    print("=" * 60)
    
    agent = PumpDiscoveryAgent()
    
    # –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞
    now_timestamp = datetime.now().timestamp() * 1000  # –í –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
    
    # –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω–∞ (—Ö–æ—Ä–æ—à–∏–µ –º–µ—Ç—Ä–∏–∫–∏, –Ω–æ —Ä–∞–∑–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç)
    base_token_data = {
        'baseToken': {'address': '0x123', 'symbol': 'TEST', 'name': 'Test Token'},
        'liquidity': {'usd': 25000},    # –•–æ—Ä–æ—à–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
        'volume': {'h24': 15000},       # –•–æ—Ä–æ—à–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å  
        'priceChange': {'h24': 25}      # –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞
    }
    
    # –¢–ï–°–¢ 1: –¢–æ–∫–µ–Ω 10 —á–∞—Å–æ–≤ (—Å–ª–∏—à–∫–æ–º –º–æ–ª–æ–¥–æ–π - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω)
    print(f"\n1Ô∏è‚É£ –¢–ï–°–¢: –¢–æ–∫–µ–Ω –≤–æ–∑—Ä–∞—Å—Ç–æ–º 10 —á–∞—Å–æ–≤ (< {PUMP_FILTERS['min_age_hours']}—á)")
    token_10h = base_token_data.copy()
    token_10h['pairCreatedAt'] = now_timestamp - (10 * 60 * 60 * 1000)  # 10 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥
    
    should_analyze_10h = agent.should_analyze_pair(token_10h)
    print(f"   ‚è∞ –í–æ–∑—Ä–∞—Å—Ç: 10 —á–∞—Å–æ–≤")
    print(f"   üìä –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å: ${token_10h['liquidity']['usd']:,}")
    print(f"   üìà –û–±—ä–µ–º 24—á: ${token_10h['volume']['h24']:,}")
    print(f"   üö´ –î–æ–ª–∂–µ–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è: {should_analyze_10h}")
    print(f"   ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: False (–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ min_age)")
    
    # –¢–ï–°–¢ 2: –¢–æ–∫–µ–Ω 30 —á–∞—Å–æ–≤ (–≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ 25-48—á)
    print(f"\n2Ô∏è‚É£ –¢–ï–°–¢: –¢–æ–∫–µ–Ω –≤–æ–∑—Ä–∞—Å—Ç–æ–º 30 —á–∞—Å–æ–≤ (–≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ {PUMP_FILTERS['min_age_hours']}-{PUMP_FILTERS['max_age_hours']}—á)")
    token_30h = base_token_data.copy()
    token_30h['pairCreatedAt'] = now_timestamp - (30 * 60 * 60 * 1000)  # 30 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥
    
    should_analyze_30h = agent.should_analyze_pair(token_30h)
    print(f"   ‚è∞ –í–æ–∑—Ä–∞—Å—Ç: 30 —á–∞—Å–æ–≤")
    print(f"   üìä –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å: ${token_30h['liquidity']['usd']:,}")
    print(f"   üìà –û–±—ä–µ–º 24—á: ${token_30h['volume']['h24']:,}")
    print(f"   ‚úÖ –î–æ–ª–∂–µ–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è: {should_analyze_30h}")
    print(f"   ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: True (–≤ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ)")
    
    # –¢–ï–°–¢ 3: –¢–æ–∫–µ–Ω 60 —á–∞—Å–æ–≤ (—Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–π)
    print(f"\n3Ô∏è‚É£ –¢–ï–°–¢: –¢–æ–∫–µ–Ω –≤–æ–∑—Ä–∞—Å—Ç–æ–º 60 —á–∞—Å–æ–≤ (> {PUMP_FILTERS['max_age_hours']}—á)")
    token_60h = base_token_data.copy()
    token_60h['pairCreatedAt'] = now_timestamp - (60 * 60 * 60 * 1000)  # 60 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥
    
    should_analyze_60h = agent.should_analyze_pair(token_60h)
    print(f"   ‚è∞ –í–æ–∑—Ä–∞—Å—Ç: 60 —á–∞—Å–æ–≤")
    print(f"   üìä –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å: ${token_60h['liquidity']['usd']:,}")
    print(f"   üìà –û–±—ä–µ–º 24—á: ${token_60h['volume']['h24']:,}")
    print(f"   üö´ –î–æ–ª–∂–µ–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è: {should_analyze_60h}")
    print(f"   ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: False (–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ max_age)")
    
    # –ü–†–û–í–ï–†–Ø–ï–ú –†–ï–ó–£–õ–¨–¢–ê–¢–´
    print(f"\nüìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:")
    print(f"   üî¥ –¢–æ–∫–µ–Ω 10—á: {should_analyze_10h} (–æ–∂–∏–¥–∞–µ–º False)")
    print(f"   üü¢ –¢–æ–∫–µ–Ω 30—á: {should_analyze_30h} (–æ–∂–∏–¥–∞–µ–º True)")
    print(f"   üî¥ –¢–æ–∫–µ–Ω 60—á: {should_analyze_60h} (–æ–∂–∏–¥–∞–µ–º False)")
    
    # –ü–†–û–í–ï–†–Ø–ï–ú –°–¢–ê–¢–ò–°–¢–ò–ö–£
    stats = agent.pump_stats
    print(f"\nüìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –§–ò–õ–¨–¢–†–ê–¶–ò–ò:")
    print(f"   –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –ø–æ min_age: {stats['filtered_by_min_age']}")
    print(f"   –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –ø–æ max_age: {stats['filtered_by_max_age']}")
    print(f"   –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –ø–æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏: {stats['filtered_by_liquidity']}")
    
    # –í–ê–õ–ò–î–ê–¶–ò–Ø
    success = True
    if should_analyze_10h != False:
        print(f"‚ùå –û–®–ò–ë–ö–ê: –¢–æ–∫–µ–Ω 10—á –Ω–µ –±—ã–ª –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ min_age!")
        success = False
    if should_analyze_30h != True:
        print(f"‚ùå –û–®–ò–ë–ö–ê: –¢–æ–∫–µ–Ω 30—á –±—ã–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω!")
        success = False
    if should_analyze_60h != False:
        print(f"‚ùå –û–®–ò–ë–ö–ê: –¢–æ–∫–µ–Ω 60—á –Ω–µ –±—ã–ª –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ max_age!")
        success = False
        
    if success:
        print(f"\nüéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´! –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–ê–ë–û–¢–ê–ï–¢!")
        print(f"\nüîß –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û:")
        print(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ ({PUMP_FILTERS['min_age_hours']}—á)")
        print(f"   ‚úÖ –¢–æ–∫–µ–Ω—ã –º–ª–∞–¥—à–µ 25—á –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞—é—Ç—Å—è (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ volume_h24)")
        print(f"   ‚úÖ –û–∫–Ω–æ –∞–Ω–∞–ª–∏–∑–∞: {PUMP_FILTERS['min_age_hours']}-{PUMP_FILTERS['max_age_hours']} —á–∞—Å–æ–≤")
        print(f"   ‚úÖ –í—Å–µ volume_ratio —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã")
        
        print(f"\nüí° –ü–û–ß–ï–ú–£ –≠–¢–û –í–ê–ñ–ù–û:")
        print(f"   üö´ –†–∞–Ω—å—à–µ: —Ç–æ–∫–µ–Ω 6—á ‚Üí volume_h24 –∑–∞ 6—á ‚Üí –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π volume_ratio")
        print(f"   ‚úÖ –¢–µ–ø–µ—Ä—å: —Ç–æ–∫–µ–Ω 30—á ‚Üí volume_h24 –∑–∞ 24—á ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π volume_ratio")
        print(f"   üìä –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —Ç–µ–ø–µ—Ä—å —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ —Å—Ä–∞–≤–Ω–∏–º—ã –º–µ–∂–¥—É —Ç–æ–∫–µ–Ω–∞–º–∏")
    else:
        print(f"\n‚ùå –¢–ï–°–¢–´ –ù–ï –ü–†–û–ô–î–ï–ù–´! –¢–†–ï–ë–£–ï–¢–°–Ø –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï!")
        return False
        
    return True

if __name__ == "__main__":
    test_age_filter()
